/*
  -------------------------------
  Ù‚Ù†Ø§Ø© "Ø§Ù„ÙˆØ±Ø´Ø©" - Arduino Retro Games
  -------------------------------
  
  Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ© Ø¹Ù„Ù‰ Ù‚Ù†Ø§Ø© "Ø§Ù„ÙˆØ±Ø´Ø©"!  
  ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ØŒ Ù‡ØªÙ„Ø§Ù‚ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„ØªÙŠ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ Ù…Ø«Ù„:
  - **Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†** (Snake)
  - **ØªÙŠØªØ±Ø³** (Tetris)
  - **Ø¨Ø±ÙŠÙƒ Ø£ÙˆØª** (Breakout)
  - **Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª** (Car Racing)
  - **Ø¨ÙŠÙ†Ø¬ Ø¨ÙˆÙ†Ø¬** (Ping Pong)
  - **ØºØ²Ùˆ Ø§Ù„ÙØ¶Ø§Ø¡** (Space Invaders)

  Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø¯ÙŠ Ù…Ø¨Ù†ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒÙˆÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø© Ù…Ø«Ù„:
  - Ø´Ø§Ø´Ø© LED Matrix Ø£Ùˆ OLED.
  - Ø¹ØµØ§ ØªØ­ÙƒÙ… Ø£Ùˆ Ø£Ø²Ø±Ø§Ø±.
  - Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ Uno Ø£Ùˆ Nano.

  Ø§Ù„Ù‚Ù†Ø§Ø© Ù…ØªØ®ØµØµØ© ÙÙŠ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…Ø¨ØªÙƒØ±Ø© ÙˆØ£Ù„Ø¹Ø§Ø¨ØŒ ÙˆÙ‡ÙŠ Ù…ØµØ¯Ø±Ùƒ Ù„Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„ØªØ³Ù„ÙŠØ© Ù…Ø¹Ø§Ù‹!
  ØªÙ‚Ø¯Ø± ØªØªØ§Ø¨Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© Ø¹Ø´Ø§Ù† ØªØ¹Ø±Ù ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø± Ø¹Ù† ÙƒÙ„ Ù„Ø¹Ø¨Ø© ÙˆÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ°Ù‡Ø§.
  
  ØªØ§Ø¨Ø¹ Ø§Ù„Ù‚Ù†Ø§Ø© Ø¹Ù„Ù‰ ÙŠÙˆØªÙŠÙˆØ¨:
 https://www.youtube.com/@Ø§Ù„ÙˆØ±Ø´Ø©249


  Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ù„ØªØ¹Ù„Ù…! ğŸ®ğŸ”§
*/


#include <LedControl.h>

LedControl lc = LedControl(12, 11, 10, 1); // DIN, CLK, CS, Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµÙÙˆÙØ§Øª

int paddleX = 3;
int ballX = 3, ballY = 5;
int ballDX = 1, ballDY = -1;

const int joyX = A0;
const int buzzer = 8;

bool bricks[3][8];

void setup() {
  lc.shutdown(0, false);
  lc.setIntensity(0, 8);
  lc.clearDisplay(0);

  pinMode(buzzer, OUTPUT);

  // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·ÙˆØ¨
  for (int y = 0; y < 3; y++)
    for (int x = 0; x < 8; x++)
      bricks[y][x] = true;
}

void loop() {
  lc.clearDisplay(0);

  // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø¶Ø±Ø¨
  int xVal = analogRead(joyX);
  if (xVal < 400 && paddleX > 0) paddleX--;
  else if (xVal > 600 && paddleX < 5) paddleX++;

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±Ø©
  ballX += ballDX;
  ballY += ballDY;

  // Ø§Ø±ØªØ¯Ø§Ø¯ Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨
  if (ballX < 0 || ballX > 7) {
    ballDX *= -1;
    ballX += ballDX;
  }

  // Ø§Ø±ØªØ¯Ø§Ø¯ Ù…Ù† Ø§Ù„Ø³Ù‚Ù
  if (ballY < 0) {
    ballDY *= -1;
    ballY += ballDY;
  }

  // Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ù…Ø¶Ø±Ø¨
  if (ballY == 7 && (ballX >= paddleX && ballX <= paddleX + 2)) {
    ballDY *= -1;
    tone(buzzer, 800, 50);

    if (ballX == paddleX) ballDX = -1;
    else if (ballX == paddleX + 2) ballDX = 1;
    // Ù„Ùˆ ÙÙŠ Ø§Ù„Ù†Øµ ÙŠÙØ¶Ù„ Ù†ÙØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
  }

  // Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø·ÙˆØ¨
  if (ballY < 3 && bricks[ballY][ballX]) {
    bricks[ballY][ballX] = false;
    ballDY *= -1;
    tone(buzzer, 1000, 50);
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ²
  if (allBricksBroken()) {
    celebrateWin();
    resetGame();
    return;
  }

  // Game Over
  if (ballY > 7) {
    tone(buzzer, 200, 1000);
    delay(1000);
    resetGame();
    return;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø·ÙˆØ¨
  for (int y = 0; y < 3; y++)
    for (int x = 0; x < 8; x++)
      if (bricks[y][x]) lc.setLed(0, y, x, true);

  // Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ±Ø©
  lc.setLed(0, ballY, ballX, true);

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¶Ø±Ø¨
  lc.setLed(0, 7, paddleX, true);
  lc.setLed(0, 7, paddleX + 1, true);
  lc.setLed(0, 7, paddleX + 2, true);

  delay(200);
}

// Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø©
void resetGame() {
  ballX = 3; ballY = 5;
  ballDX = 1; ballDY = -1;
  paddleX = 3;

  for (int y = 0; y < 3; y++)
    for (int x = 0; x < 8; x++)
      bricks[y][x] = true;
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙÙˆØ² Ø§Ù„Ù„Ø§Ø¹Ø¨
bool allBricksBroken() {
  for (int y = 0; y < 3; y++)
    for (int x = 0; x < 8; x++)
      if (bricks[y][x]) return false;
  return true;
}

// Ø§Ø­ØªÙØ§Ù„ Ø§Ù„ÙÙˆØ² ğŸ‰
void celebrateWin() {
  for (int i = 0; i < 5; i++) {
    lc.clearDisplay(0);
    tone(buzzer, 1500, 100);
    delay(150);

    for (int y = 0; y < 8; y++)
      for (int x = 0; x < 8; x++)
        lc.setLed(0, y, x, true);

    tone(buzzer, 1000, 100);
    delay(150);
  }

  noTone(buzzer);
  lc.clearDisplay(0);
  delay(1000);
}

#include <LedControl.h>

#define DIN 12
#define CLK 11
#define CS 10
LedControl lc = LedControl(DIN, CLK, CS, 1);

#define JOY_X A0
#define JOY_Y A1
#define JOY_BTN 2

#define BUZZER 3

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
byte invaders[8] = {0};
byte playerPos = 3;
bool laserActive = false;
byte laserHeight = 0;
unsigned long lastMoveTime = 0;
unsigned long lastInvaderMoveTime = 0;
unsigned long lastSpawnTime = 0;
int score = 0;
bool gameOver = false;
byte currentInvaders = 1; // ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯Ø¯ Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
byte maxInvaders = 5;     // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø£Ø¹Ø¯Ø§Ø¡
byte level = 1;
const int maxLevel = 5;

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±Ø¹Ø©
const int playerMoveDelay = 200;
const int laserMoveDelay = 100;
int invaderMoveDelay = 1000; // ÙŠÙ‚Ù„ Ù…Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
const int invaderSpawnDelay = 2000;

// Ø±Ø³Ø§Ù„Ø© GAME OVER
const byte gameOverMsg[8] = {
  B01111110, // G
  B01000010,
  B01000010,
  B01111110,
  B01001010, // M
  B01000110,
  B01000010,
  B01000010
};

// Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
const byte digits[10][8] = {
  {B00111100,B01000010,B01000010,B01000010,B01000010,B01000010,B01000010,B00111100}, // 0
  {B00011000,B00111000,B00011000,B00011000,B00011000,B00011000,B00011000,B01111110}, // 1
  {B00111100,B01000010,B00000110,B00011100,B00110000,B01100000,B01000000,B01111110}, // 2
  {B00111100,B01000010,B00000010,B00011100,B00000010,B00000010,B01000010,B00111100}, // 3
  {B00000100,B00001100,B00010100,B00100100,B01000100,B01111110,B00000100,B00000100}, // 4
  {B01111110,B01000000,B01000000,B01111100,B00000010,B00000010,B01000010,B00111100}, // 5
  {B00111100,B01000000,B01000000,B01111100,B01000010,B01000010,B01000010,B00111100}, // 6
  {B01111110,B00000010,B00000100,B00001000,B00010000,B00100000,B01000000,B01000000}, // 7
  {B00111100,B01000010,B01000010,B00111100,B01000010,B01000010,B01000010,B00111100}, // 8
  {B00111100,B01000010,B01000010,B01000010,B00111110,B00000010,B00000010,B00111100}  // 9
};

void setup() {
  lc.shutdown(0, false);
  lc.setIntensity(0, 8);
  lc.clearDisplay(0);
  
  pinMode(JOY_BTN, INPUT_PULLUP);
  pinMode(BUZZER, OUTPUT);

  randomSeed(analogRead(5));
  startGame();
}

void startGame() {
  for(int i=0; i<8; i++) invaders[i] = 0;
  
  playerPos = 3;
  laserActive = false;
  score = 0;
  gameOver = false;
  currentInvaders = 1;
  level = 1;
  invaderMoveDelay = 1000;
  
  tone(BUZZER, 523, 200);
  delay(200);
  tone(BUZZER, 659, 200);
  delay(200);
  tone(BUZZER, 784, 200);
  
  updateDisplay();
}

void loop() {
  if (gameOver) {
    showGameOver();
    if (digitalRead(JOY_BTN) == LOW) {
      startGame();
    }
    return;
  }

  unsigned long currentTime = millis();

  if (currentTime - lastMoveTime > playerMoveDelay) {
    handleJoystick();
    lastMoveTime = currentTime;
  }

  if (laserActive && currentTime - lastMoveTime > laserMoveDelay) {
    updateLaser();
  }

  if (currentTime - lastInvaderMoveTime > invaderMoveDelay) {
    moveInvaders();
    lastInvaderMoveTime = currentTime;
  }

  if (currentTime - lastSpawnTime > invaderSpawnDelay) {
    spawnInvaders();
    lastSpawnTime = currentTime;
  }

  updateDisplay();
}

void handleJoystick() {
  int xValue = analogRead(JOY_X);
  
  if (xValue < 400 && playerPos > 0) playerPos--;
  else if (xValue > 600 && playerPos < 7) playerPos++;
  
  if (digitalRead(JOY_BTN) == LOW && !laserActive) {
    laserActive = true;
    laserHeight = 6;
    tone(BUZZER, 349, 100);
  }
}

void updateLaser() {
  laserHeight--;
  
  if (laserHeight == 0) {
    laserActive = false;
  } else {
    if (invaders[laserHeight] & (1 << (7 - playerPos))) {
      invaders[laserHeight] &= ~(1 << (7 - playerPos));
      laserActive = false;
      score += 10;
      currentInvaders--;
      tone(BUZZER, 698, 100);
      
      if (currentInvaders == 0) {
        levelUp();
      }
    }
  }
}

void moveInvaders() {
  for (int i = 7; i > 0; i--) {
    invaders[i] = invaders[i-1];
  }
  invaders[0] = 0;

  if (invaders[7] != 0) {
    gameOver = true;
    playGameOverSound();
  }
}

void spawnInvaders() {
  if (currentInvaders < maxInvaders && random(100) < 30 + level*10) {
    byte newInvader = 1 << random(8);
    invaders[0] |= newInvader;
    currentInvaders++;
  }
}

void levelUp() {
  level++;
  if (level > maxLevel) level = maxLevel;
  
  invaderMoveDelay = max(500, 1000 - (level-1)*150); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ù…Ø¹ ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰
  maxInvaders = min(5, 1 + level); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø¯ Ø­ØªÙ‰ 5
  
  tone(BUZZER, 784, 200);
  delay(200);
  tone(BUZZER, 880, 400);
}

void updateDisplay() {
  if (gameOver) return;
  
  lc.clearDisplay(0);
  
  for (int row = 0; row < 8; row++) {
    lc.setRow(0, row, invaders[row]);
  }
  
  lc.setLed(0, 7, playerPos, true);
  
  if (laserActive) {
    for (int row = laserHeight; row < 7; row++) {
      lc.setLed(0, row, playerPos, true);
    }
  }
}

void showGameOver() {
  // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© GAME OVER
  for (int row = 0; row < 8; row++) {
    lc.setRow(0, row, gameOverMsg[row]);
  }
  delay(2000);
  
  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  displayScore();
  delay(1000);
  
  // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
  while(digitalRead(JOY_BTN) == HIGH) {
    delay(100);
  }
}

void displayScore() {
  lc.clearDisplay(0);
  
  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ø³Ù„Ø³Ù„Ø©
  String scoreStr = String(score);
  
  // Ø¹Ø±Ø¶ ÙƒÙ„ Ø±Ù‚Ù… Ø¹Ù„Ù‰ Ø­Ø¯Ø©
  for (int i = 0; i < scoreStr.length(); i++) {
    char c = scoreStr.charAt(i);
    int digit = c - '0';
    
    if (digit >= 0 && digit <= 9) {
      for (int row = 0; row < 8; row++) {
        lc.setRow(0, row, digits[digit][row]);
      }
    }
    
    delay(800);
    lc.clearDisplay(0);
    delay(200);
  }
}

void playGameOverSound() {
  tone(BUZZER, 220, 300);
  delay(300);
  tone(BUZZER, 196, 300);
  delay(300);
  tone(BUZZER, 175, 500);
}
